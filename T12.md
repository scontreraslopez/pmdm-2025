<!-- markdownlint-disable MD029-->
# T12 - Integraci√≥n con Firebase y empaquetado para Play Store

## Introducci√≥n a Firebase Authentication

Una de las funcionalidades m√°s ubicuas en las aplicaciones m√≥viles es la autenticaci√≥n de usuarios. Firebase Authentication es una soluci√≥n robusta y f√°cil de implementar que permite a los desarrolladores integrar m√∫ltiples m√©todos de autenticaci√≥n en sus aplicaciones, como correo electr√≥nico, Google, Facebook, entre otros.

Empecemos por hablar de Firebase. **Firebase** es una plataforma de desarrollo de aplicaciones m√≥viles y web que ofrece una variedad de servicios, incluyendo autenticaci√≥n, base de datos en tiempo real, almacenamiento en la nube y an√°lisis. Firebase Authentication es uno de estos servicios y facilita la implementaci√≥n de sistemas de autenticaci√≥n seguros y escalables. Es lo que se conoce como **Backend as a Service (BaaS)**, ya que proporciona una infraestructura backend lista para usar, permitiendo a los desarrolladores centrarse en la creaci√≥n de la experiencia del usuario sin preocuparse por la gesti√≥n del servidor. Otro popular **BaaS** es **Supabase**, que tambi√©n ofrece servicios similares a Firebase, pero con un enfoque en bases de datos SQL (postgrest) y c√≥digo abierto. Para entrar a la consola de Firebase, se puede acceder a trav√©s de [Firebase Console](https://console.firebase.google.com/).

El tema de la autenticaci√≥n a trav√©s de Firebase lo podemos encontrar en [https://firebase.google.com/docs/auth?hl=es-419](https://firebase.google.com/docs/auth?hl=es-419). Nosotros nos decantaremos en la opci√≥n de **Quiero crear mi sistema de autenticaci√≥n con Firebase**. Firebase cuenta para ello con **Firebase UI**, que es una biblioteca que proporciona una interfaz de usuario preconstruida para la autenticaci√≥n, facilitando a√∫n m√°s la integraci√≥n de m√∫ltiples m√©todos de inicio de sesi√≥n en las aplicaciones. Firebase UI soporta varios proveedores de autenticaci√≥n, incluyendo correo electr√≥nico y contrase√±a, Google, Facebook, Twitter, GitHub, y m√°s. [https://firebase.google.com/docs/auth/android/firebaseui?hl=es-419](https://firebase.google.com/docs/auth/android/firebaseui?hl=es-419).

Lamentablemente, Firebase UI a fecha de hoy (Diciembre 2025) est√° todav√≠a en beta para Jetpack Compose (`implementation("com.firebaseui:firebase-ui-auth:10.0.0-beta01")`), y la documentaci√≥n oficial no est√° completa. Por lo que todav√≠a tendremos que esperar un poco para tener una soluci√≥n completamente integrada con Compose. Sin embargo, es posible integrar Firebase Authentication en aplicaciones Jetpack Compose utilizando las bibliotecas de Firebase y creando interfaces de usuario personalizadas.

Tenemos un v√≠deo del desarrollador m√≥vil Aristidevs que la verdad lo explica bastante bien, adem√°s de que es muy positivo ver a otras personas con experiencia desarrollar, siempre se aprende algo. [https://www.youtube.com/watch?v=LxABxtwhrDE](https://www.youtube.com/watch?v=LxABxtwhrDE). El v√≠deo es bastante largo, pero el tema de Firebase y Firebase Authentication se cubren en la primera hora. Alternativamente, te dejo aqu√≠ un repositorio [https://github.com/scontreraslopez/T14-Firebase](https://github.com/scontreraslopez/T14-Firebase) que contiene un ejemplo b√°sico (*el repositorio es un fork del repositorio de un compa√±ero, que he modificado muy ligeramente para las versiones actuales*). En el v√≠deo de Aristidevs tambi√©n os deja un repositorio similar en [https://github.com/ArisGuimera/Curso-Firebase-Lite](https://github.com/ArisGuimera/Curso-Firebase-Lite), usad con el que os sint√°is m√°s c√≥modos.

Para integrar Firebase Authentication en una aplicaci√≥n Android desarrollada con Jetpack Compose, se deben seguir varios pasos clave:

- Ir a [Firebase Console](https://console.firebase.google.com/) y crear un nuevo proyecto, por ejemplo, "Firebase Authentication Demo".
- Lo Una vez creado hay que darle al bot√≥n de "Agregar aplicaci√≥n" y seleccionar Android.
Ah√≠ se debe ingresar el nombre del paquete de la aplicaci√≥n, que debe coincidir con el nombre del paquete en el archivo `build.gradle` del m√≥dulo de la aplicaci√≥n. Tambi√©n se puede proporcionar un apodo para la aplicaci√≥n y el certificado de huella digital SHA-1, aunque este √∫ltimo es opcional para la autenticaci√≥n b√°sica. Ejemplo

![Registrar firebase app](/img/T12/image-1.png)

- Descargamos el archivo `google-services.json` proporcionado por Firebase y lo colocamos en el directorio `app/` de nuestro proyecto Android.

Si prefer√≠s implementar la autenticaci√≥n con firebase vosotros mismos, pues entonces adem√°s de la implementaci√≥n deber√©is:

- A√±adir las dependencias necesarias en el archivo `build.gradle` del m√≥dulo de la aplicaci√≥n. Esto incluye las bibliotecas de Firebase Authentication y Firebase UI. Esto viene explicado en el propio walkthrough en la consola de Firebase. Presta atenci√≥n a la diferencia entre nivel de m√≥dulo y nivel de proyecto en el `build.gradle`.

## Publicaci√≥n de Apps Android

La parte de la publicaci√≥n de una App de Android en Play Store se cubre bastante bien en el siguiente video [https://youtu.be/3Lw1tGJPnvc?si=bAG9iArq61nVb7lv&t=3463](https://youtu.be/3Lw1tGJPnvc?si=bAG9iArq61nVb7lv&t=3463) del canal de YouTube "DevExpert - Programaci√≥n Android y Kotlin". El video est√° en espa√±ol y cubre todo el proceso de publicaci√≥n de una app en Google Play, desde la preparaci√≥n del proyecto hasta la subida a la tienda. El video tiene una duraci√≥n de aproximadamente 1 hora y 15 minutos, pero te he enlazado justo el minuto donde empieza a hablar de la publicaci√≥n en Google Play. Por supuesto todo el video es interesante, dado que est√° orientado al desarrollo apoyado en la IA que es una parte que no hemos cubierto en clase pero que es interesante conocer.

Esta gu√≠a cubre todo el ciclo de vida de publicaci√≥n, desde la preparaci√≥n t√©cnica del c√≥digo hasta la distribuci√≥n final en Google Play o sitios web propios.

**Nota Importante:** Desde **agosto de 2021**, todas las apps nuevas en Google Play deben publicarse usando **Android App Bundle (AAB)** en lugar de APK. Adem√°s, desde junio de 2023, esto tambi√©n aplica a las apps de TV.

El enlace a la documentaci√≥n oficial de Google a este respecto es: [https://developer.android.com/studio/publish](https://developer.android.com/studio/publish)

---

### FASE 1: Preparaci√≥n T√©cnica de la App

Antes de pensar en subir la app, debes asegurarte de que el c√≥digo y los recursos est√©n listos para producci√≥n.

#### Configuraci√≥n para el lanzamiento (Release)

El entorno de desarrollo es diferente al de producci√≥n. Debes realizar los siguientes ajustes en tu archivo `build.gradle` (o `build.gradle.kts`):

- **Desactivar la depuraci√≥n (Debugging):** Es crucial por seguridad y rendimiento.
  - En el bloque `buildTypes > release`, aseg√∫rate de configurar `debuggable false` (Groovy) o `isDebuggable = false` (Kotlin).
- **Desactivar el registro (Logging):** Elimina las llamadas a `Log` y cualquier archivo de prueba est√°tico.
- **Identificador de la aplicaci√≥n:** Aseg√∫rate de que el `applicationId` sea el definitivo; no podr√°s cambiarlo una vez publicada la app.

#### Limpieza de recursos y c√≥digo

- **Shrinking (Reducci√≥n):** Habilita la reducci√≥n (previamente ProGuard/R8) en tu build de release para eliminar c√≥digo no usado y ofuscar clases.
- **Directorios:**
  - `src/`: Solo debe contener fuentes de tu app (Java/Kotlin).
  - `lib/`: Solo librer√≠as de terceros necesarias. Elimina librer√≠as de test.
  - `res/`: Elimina archivos *drawable*, *layout* o *values* antiguos que ya no se usen.
- **WebView:** Si usas WebViews, deshabilita la depuraci√≥n de contenidos web con `WebView.setWebContentsDebuggingEnabled(false)`.

#### Revisi√≥n de Pol√≠ticas (Play Policy Insights)

Android Studio incluye una herramienta para prevenir rechazos en la tienda.

- Ve a **Code > Inspect for Play Policy Insights**.
- Esto te mostrar√° advertencias sobre permisos o SDKs que podr√≠an violar pol√≠ticas de Google Play.

---

### FASE 2: Versionado y Compatibilidad

El versionado es vital para que los usuarios reciban actualizaciones y el sistema gestione la compatibilidad.

#### Configuraci√≥n de Versiones

En tu archivo `build.gradle` a nivel de m√≥dulo, dentro de `defaultConfig`:

1. **`versionCode` (Entero positivo):** Es un n√∫mero interno. **Debe aumentar** con cada actualizaci√≥n (ej. 1, 2, 3...). Google Play no permite subir un APK/AAB con un `versionCode` igual o inferior a uno ya existente.
2. **`versionName` (String):** Es lo que ve el usuario (ej. "1.0", "2.1-beta"). No tiene impacto t√©cnico en la actualizaci√≥n.

#### Niveles de API (SDK)

Define en qu√© dispositivos funcionar√° tu app:

- **`minSdk`:** La versi√≥n m√≠nima de Android requerida. Si el dispositivo tiene una versi√≥n inferior, no podr√° instalar la app.
- **`targetSdk`:** La versi√≥n para la que dise√±aste y probaste la app (generalmente la m√°s reciente disponible).

---

### FASE 3: Firma de la Aplicaci√≥n (Signing)

Android requiere que todas las apps est√©n firmadas digitalmente. Para Google Play, el est√°ndar es **Play App Signing**.

#### Conceptos Clave

- **Upload Key (Clave de carga):** La generas t√∫ y la guardas en tu PC. Se usa para firmar el AAB antes de subirlo a Google.
- **App Signing Key (Clave de firma de app):** Google gestiona esta clave. Google la usa para firmar los APKs que se distribuyen a los usuarios finales.

#### C√≥mo generar una clave de carga (Upload Key) en Android Studio

1. Ve a **Build > Generate Signed Bundle/APK**.
2. Selecciona **Android App Bundle** (Recomendado) o APK.
3. Haz clic en **Create new** bajo el campo "Key store path".
4. Rellena los datos:

- **Keystore path:** D√≥nde guardar el archivo `.jks`.
- **Password:** Contrase√±a fuerte para el almac√©n.
- **Alias:** Nombre para identificar tu clave.
- **Validity:** **M√≠nimo 25 a√±os**. Google exige que la validez termine despu√©s del **22 de octubre de 2033**.

5. Finaliza el proceso para generar tu primera build firmada.

> **SEGURIDAD:** Nunca compartas tu clave privada ni las contrase√±as del Keystore. Si pierdes la *Upload Key*, puedes pedir un reseteo en la Play Console, pero si pierdes la *App Signing Key* (en el caso de gesti√≥n manual antigua), no podr√°s actualizar la app nunca m√°s.

---

### FASE 4: Construcci√≥n y Pruebas (Build & Test)

#### Generar el Artefacto

Usa la opci√≥n **Build > Generate Signed Bundle/APK** y selecciona la variante `release`.

- Esto generar√° un archivo `.aab` (App Bundle) optimizado y firmado.
- El App Bundle permite que Google Play genere APKs espec√≠ficos para cada dispositivo (Dynamic Delivery), reduciendo el peso de descarga para el usuario.

#### Pruebas Finales

- **Dispositivos Reales:** Prueba en al menos un tel√©fono y una tablet.
- **Firebase Test Lab:** √ötil para probar en m√∫ltiples configuraciones y versiones de Android en la nube.
- **Servidores Externos:** Si tu app usa backend, aseg√∫rate de que las URLs apunten a los servidores de producci√≥n (no a los de desarrollo/test).

---

### FASE 5: Publicaci√≥n en Google Play

Google Play es la plataforma principal para alcanzar una audiencia global.

#### Preparaci√≥n de la Ficha

Antes de subir el binario, necesitas:

- **Icono de alta resoluci√≥n.**
- **Capturas de pantalla (Screenshots):** Tel√©fono, tablet de 7", tablet de 10".
- **Texto promocional:** T√≠tulo, descripci√≥n corta y descripci√≥n completa.
- **Gr√°fico de funciones:** Imagen promocional principal.

#### Subida a la Play Console

1. Crea una cuenta de desarrollador (si no la tienes).
2. Crea una nueva aplicaci√≥n.
3. Configura **Play App Signing** (Google te guiar√°; generalmente usar√°s la clave que generaste en la Fase 3 como tu *Upload Key*).
4. Ve a la secci√≥n **Producci√≥n** o **Testing** (Alfa/Beta).
5. Sube tu archivo `.aab`.

#### Tipos de Lanzamiento (Tracks)

- **Pruebas Internas:** R√°pido, para tu equipo. Puedes usar tambi√©n *Firebase App Distribution*.
- **Pruebas Cerradas (Alfa):** Para un grupo peque√±o de testers seleccionados.
- **Pruebas Abiertas (Beta):** Visible en la tienda para usuarios que quieran probar versiones tempranas.
- **Producci√≥n:** Lanzamiento general al p√∫blico.

#### Revisi√≥n

Una vez que hagas clic en "Publicar", tu app pasar√° por una revisi√≥n de Google. Esto puede tardar desde unas horas hasta varios d√≠as.

---

### FASE 6: Alternativa - Publicaci√≥n en Sitio Web

Si no quieres usar Google Play, puedes distribuir tu app directamente.

1. **Genera un APK firmado:** En lugar de un AAB, genera un APK desde Android Studio.
2. **Aloja el archivo:** Sube el APK a tu servidor web.
3. **Enlace de descarga:** Proporciona un link directo al usuario.

**Consideraciones para el usuario ("Or√≠genes desconocidos"):**

- **Android 8.0 (Oreo) y superior:** El usuario debe dar permiso expl√≠cito al navegador (ej. Chrome) para "Instalar aplicaciones desconocidas".
- **Android 7.1.1 y anterior:** El usuario debe activar la opci√≥n global "Or√≠genes desconocidos" en Seguridad.

**Desventajas de este m√©todo:**

- No tienes acceso a actualizaciones autom√°ticas.
- No puedes usar Google Play Billing (compras in-app).
- Menor confianza del usuario debido a las advertencias de seguridad de Android.

---

### Resumen de Tareas Cr√≠ticas

| Tarea | Detalle |
| :--- | :--- |
| **Limpieza** | Quitar logs, `debuggable=false`, limpiar recursos no usados. |
| **Versionado** | Incrementar `versionCode` en cada subida. |
| **Firma** | Generar Keystore con validez > 25 a√±os. Usar Play App Signing. |
| **Formato** | Usar **Android App Bundle (.aab)** para Google Play. |
| **Legal** | Preparar EULA (Acuerdo de licencia) y Pol√≠tica de Privacidad. |

## Tareas de esta unidad

Para esta unidad deb√©is entregar varias cosas que dividiremos en dos packs.

**Entrega 1: Pack intents + Retrofit (Pokeapi):**

- SeveroOchoaIntents (T11).
- PokeApi (T11).

**Entrega 2: Implementaci√≥n del Proyecto Intermodular:**

### üéØ Objetivo

Desarrollar la **l√≥gica funcional y la implementaci√≥n t√©cnica** de la aplicaci√≥n m√≥vil cuya interfaz hab√©is dise√±ado en el m√≥dulo de *Desarrollo de Interfaces*. La aplicaci√≥n debe ser funcional, robusta y conectar con servicios externos.

### üß≠ Contexto T√©cnico

La aplicaci√≥n debe ser fiel al dise√±o visual aprobado (gu√≠a de estilo y wireframes de DIN) pero a√±adiendo la capa de inteligencia y datos.
La aplicaci√≥n deber√° gestionar:

- **Identidad:** Autenticaci√≥n de usuarios en la nube.
- **Datos:** Persistencia y consulta de datos remotos (API REST).
- **L√≥gica de Negocio:** Gesti√≥n de reservas, validaciones y navegaci√≥n.

### üìù Consigna T√©cnica

#### 1. Arquitectura y Estructura

- El c√≥digo debe estar estructurado, documentado y ser mantenible.
- Se valorar√° el uso de patrones de dise√±o vistos en clase (MVVM, Clean Architecture, o separaci√≥n por paquetes l√≥gicos).
- **Coherencia Visual:** Debes implementar los layouts (XML o Jetpack Compose) respetando la paleta de colores y tipograf√≠a definidas en tu gu√≠a de estilo de DIN.

#### 2. Funcionalidad Backend (API REST)

- La app debe consumir informaci√≥n de vuestro backend mediante **Retrofit**.
- Debe manejar correctamente los estados de carga (loading) y posibles errores de conexi√≥n (feedback al usuario).

#### 3. Autenticaci√≥n (Firebase)

- Implementar login y registro funcional utilizando **Firebase Authentication**.
- Gesti√≥n de sesi√≥n (mantener la sesi√≥n iniciada o cerrar sesi√≥n).

#### 4. Pantallas Requeridas (M√≠nimo Viable)

Deben coincidir con los flujos dise√±ados en DIN:

- **Auth Screen:** Login/Registro (con validaci√≥n de campos).
- **Home/Listado:** RecyclerView/Lista obteniendo datos reales del servidor.
- **Detalle:** Pantalla para ver la informaci√≥n extendida de un elemento.
- **Edici√≥n/Creaci√≥n:** Formulario para enviar datos al servidor (POST/PUT).

> [!NOTE]
> A partir de ah√≠ si quer√©is a√±adir m√°s funcionalidades, pantallas, cach√© con base de datos local offline-first, etc. sois libres de hacerlo. Todo eso es valorado muy positivamente en la evaluaci√≥n.

### ü§ñ Pol√≠tica sobre Inteligencia Artificial

Pod√©is apoyaros en el uso de asistentes de IA (ChatGPT, GitHub Copilot, etc.) para acelerar la escritura de c√≥digo "boilerplate" o resolver dudas puntuales. **Sin embargo:**

- **Defensa oral:** Deb√©is ser capaces de explicar cada l√≠nea de c√≥digo. Si la IA escribe algo que no entend√©is, no lo incluy√°is.
- **Calidad:** La IA comete errores. Vosotros sois responsables de que el c√≥digo compile y siga las buenas pr√°cticas.

### üì¶ Entrega

- Repositorio de GitHub con el c√≥digo fuente (bien organizado, con `.gitignore` adecuado).
- APK compilado (release o debug) funcional.
- Breve v√≠deo o capturas demostrando la funcionalidad.

### ‚úÖ Criterios de evaluaci√≥n

> [!IMPORTANT]
> La aplicaci√≥n debe cumplir los siguientes criterios para ser evaluada

**Requisitos m√≠nimos (condici√≥n para ser evaluable):**

- La aplicaci√≥n debe **compilar** y **ejecutarse** sin cierres al iniciar.
- Debe existir **consumo real de API REST** y **autenticaci√≥n real con Firebase** (no se admite ‚Äúapp maqueta‚Äù).

**Penalizaci√≥n por ‚Äúapp zombie‚Äù:**

- Si la app es solo UI (pantallas pintadas) sin consumo real de API y/o sin Auth: **suspenso** (independientemente de lo ‚Äúbonita‚Äù que sea).

| Bloque | Peso | Qu√© se valora (resumen) |
| :--- | :---: | :--- |
| **Funcionalidad core (API + Auth)** | **60%** | Login/registro y sesi√≥n con Firebase; listado desde API (GET); detalle y creaci√≥n/edici√≥n (POST/PUT). Si una pantalla existe pero no conecta/persiste, punt√∫a 0 en esa parte. |
| **Implementaci√≥n t√©cnica** | **30%** | Retrofit + corrutinas/Flow, arquitectura (MVVM/clean o separaci√≥n l√≥gica), manejo de estados (loading/error), que no crashee sin internet. |
| **Fidelidad UI/UX** | **10%** | Respeto a gu√≠a de estilo de DIN, usabilidad b√°sica y feedback (cargas, errores, validaciones). |

> [!NOTE]
> **Autor√≠a / prueba de autenticidad (no punt√∫a, pero puede invalidar la nota):**
> El docente se reserva el derecho a solicitar en cualquier momento una **defensa t√©cnica**, una **prueba pr√°ctica** (p. ej. modificar una funcionalidad en directo), o preguntas sobre el c√≥digo entregado.
> Si no se demuestra autor√≠a y comprensi√≥n suficiente del proyecto, la calificaci√≥n podr√° **invalidarse** (o ajustarse) al no poder garantizarse la autor√≠a del trabajo.

Para cualquier duda t√©cnica, no dud√©is por el canal de contacto privado del aula virtual.

> [!IMPORTANT]
> **Nota para alumnos sin Proyecto Intermodular:**
> Si no est√°s cursando el proyecto intermodular o decides cambiar de tem√°tica, deber√°s entregar una **aplicaci√≥n equivalente** que cumpla todos los requisitos t√©cnicos anteriores (API + Firebase). Debe ser un desarrollo original para esta entrega, **no se permite reutilizar (refactorizar)** pr√°cticas antiguas ni proyectos de otros m√≥dulos.
